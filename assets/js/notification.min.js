if(firebase.initializeApp({messagingSenderId:"735313245766"}),"Notification"in window){var messaging=firebase.messaging();if("granted"===Notification.permission)subscribe();else{let e=getCookie("ask-to-show-notification");console.log("askToShowNotification: "+e),e=null!=e?e:1,console.log("askToShowNotification: "+e),1==e&&setTimeout(()=>{showPushSubscribeBlock(!1)},5e3)}}function showPushSubscribeBlock(e){e&&fetch("/api/event/task/push"),$(document).ready(()=>{let e=$("#notification-ask"),o=$("#notification-ask-support"),n=$(".notification-accept"),i=$(".notification-cancel"),t=$(".notification-content__timer span.seconds"),s=60,r=setInterval(()=>{0===s&&(e.hide(),clearInterval(r)),s--,countdownStr=s<10?"0"+s:s,t.html(countdownStr)},1e3);e.css("display","block"),n.on("click",n=>{e.hide(),subscribe(),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||($(".overlay").addClass("open"),o.css("display","block"),setTimeout(()=>{o.hide(),$(".overlay").removeClass("open")},3e3))}),i.on("click",o=>{e.hide(),setCookie("ask-to-show-notification",0,{expires:3600})})})}function subscribeEventTask(){messaging.requestPermission().then(function(){messaging.getToken().then(function(e){console.log(e),$("#notification-ask-support").hide(),modalsController.hide(),e?sendTokenToServer(e):(console.warn("Не удалось получить токен."),setTokenSentToServer(!1))}).catch(function(e){console.warn("При получении токена произошла ошибка.",e),setTokenSentToServer(!1),$("#notification-ask-support").hide(),modalsController.hide()})}).catch(function(e){console.warn("Не удалось получить разрешение на показ уведомлений.",e)})}function subscribe(){messaging.requestPermission().then(function(){messaging.getToken().then(function(e){console.log(e),$("#notification-ask-support").hide(),e?sendTokenToServer(e):(console.warn("Не удалось получить токен."),setTokenSentToServer(!1))}).catch(function(e){console.warn("При получении токена произошла ошибка.",e),setTokenSentToServer(!1),$("#notification-ask-support").hide()})}).catch(function(e){console.warn("Не удалось получить разрешение на показ уведомлений.",e)})}function sendTokenToServer(e){isTokenSentToServer(e)?console.log("Токен уже отправлен на сервер."):(console.log("Отправка токена на сервер..."),$.post("/notification",{token:e}),setTokenSentToServer(e))}function isTokenSentToServer(e){let o=window.localStorage.getItem("notifyToken");if(null==o)return!1;let n=JSON.parse(o);return void 0!==n.token&&(!!n.token&&(!n.token||!_USER.id||n.u_id==_USER.u_id))}function setTokenSentToServer(e){console.log("currentToken: "+e),window.localStorage.setItem("notifyToken",JSON.stringify({token:e||"",u_id:_USER.id}))}function getCookie(e){var o=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return o?decodeURIComponent(o[1]):void 0}function setCookie(e,o,n){var i=(n=n||{}).expires;if("number"==typeof i&&i){var t=new Date;t.setTime(t.getTime()+1e3*i),i=n.expires=t}i&&i.toUTCString&&(n.expires=i.toUTCString());var s=e+"="+(o=encodeURIComponent(o));for(var r in n){s+="; "+r;var c=n[r];!0!==c&&(s+="="+c)}document.cookie=s}function deleteCookie(e){setCookie(e,null,{expires:-1})}